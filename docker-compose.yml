services:
  # ğŸŸ¢ 1. ì‚¬ìš©ì ì•± (target)
  target:
    build: .
    container_name: my-app-target
    image: my-app-image:latest # ë³¸ì¸ì˜ ì•± ì´ë¯¸ì§€ë¡œ ë³€ê²½
    volumes:
      - logs:/app/logs # â­ï¸ ë¡œê·¸ í´ë” ê³µìœ  í•„ìˆ˜!
    ports:
      - "8085:8085" # ì„œë¹„ìŠ¤ í¬íŠ¸

  # ğŸŸ¡ 2. MCP ìˆ˜ì§‘ê¸° (forwarder)
  forwarder:
    image: ${FORWARDER_IMAGE}
    container_name: mcp-forwarder-demo
    depends_on: [target]
    volumes:
      - logs:/logs:ro # targetì´ ì“´ ë¡œê·¸ë¥¼ ì½ê¸° ì „ìš©ìœ¼ë¡œ ë§ˆìš´íŠ¸
    environment:
      MCP_LOG_INGEST_URL: "${MCP_DOMAIN}/api/servers/${SERVER_NAME}/ingest/logs"
      MCP_METRIC_INGEST_URL: "${MCP_DOMAIN}/api/servers/${SERVER_NAME}/ingest/metrics"
      MCP_HEALTH_INGEST_URL: "${MCP_DOMAIN}/api/servers/${SERVER_NAME}/ingest/health"
      HEALTH_URL: "http://target:9090/actuator/health"
      MCP_TOKEN: "${INGEST_TOKEN}"
      DISCORD_WEBHOOK_URL: "${DISCORD_WEBHOOK_URL}"
      LOG_PATH: "/logs/application.log"
      ACTUATOR_URL: "http://target:9090/actuator/metrics"
    restart: unless-stopped

volumes:
  logs: # ë¡œê·¸ ê³µìœ ìš© ë³¼ë¥¨ ì •ì˜